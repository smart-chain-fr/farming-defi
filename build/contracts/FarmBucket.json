{
  "contractName": "FarmBucket",
  "abi": [],
  "michelson": "[ { \"prim\": \"parameter\",\n    \"args\":\n      [ { \"prim\": \"or\",\n          \"args\":\n            [ { \"prim\": \"or\",\n                \"args\":\n                  [ { \"prim\": \"or\",\n                      \"args\":\n                        [ { \"prim\": \"address\", \"annots\": [ \"%changeAdmin\" ] },\n                          { \"prim\": \"unit\", \"annots\": [ \"%claim\" ] } ] },\n                    { \"prim\": \"or\",\n                      \"args\":\n                        [ { \"prim\": \"nat\", \"annots\": [ \"%stake\" ] },\n                          { \"prim\": \"nat\", \"annots\": [ \"%unstake\" ] } ] } ] },\n              { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"nat\", \"annots\": [ \"%mint_min_amount\" ] },\n                          { \"prim\": \"nat\",\n                            \"annots\": [ \"%mint_rate_permil\" ] } ] },\n                    { \"prim\": \"nat\", \"annots\": [ \"%reward_amount_per_sec\" ] } ],\n                \"annots\": [ \"%updateConfig\" ] } ] } ] },\n  { \"prim\": \"storage\",\n    \"args\":\n      [ { \"prim\": \"pair\",\n          \"args\":\n            [ { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"big_map\",\n                            \"args\":\n                              [ { \"prim\": \"address\" },\n                                { \"prim\": \"pair\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"nat\",\n                                              \"annots\":\n                                                [ \"%last_reward_per_stake\" ] },\n                                            { \"prim\": \"nat\",\n                                              \"annots\": [ \"%reward_amount\" ] } ] },\n                                      { \"prim\": \"nat\",\n                                        \"annots\": [ \"%stake_amount\" ] } ] } ],\n                            \"annots\": [ \"%accounts\" ] },\n                          { \"prim\": \"address\", \"annots\": [ \"%admin\" ] } ] },\n                    { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"pair\",\n                                  \"args\":\n                                    [ { \"prim\": \"nat\",\n                                        \"annots\": [ \"%mint_min_amount\" ] },\n                                      { \"prim\": \"nat\",\n                                        \"annots\": [ \"%mint_rate_permil\" ] } ] },\n                                { \"prim\": \"nat\",\n                                  \"annots\": [ \"%reward_amount_per_sec\" ] } ],\n                            \"annots\": [ \"%config\" ] },\n                          { \"prim\": \"timestamp\",\n                            \"annots\": [ \"%last_update_time\" ] } ] } ] },\n              { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"nat\",\n                            \"annots\": [ \"%reward_per_stake\" ] },\n                          { \"prim\": \"address\",\n                            \"annots\": [ \"%reward_token\" ] } ] },\n                    { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"address\", \"annots\": [ \"%token\" ] },\n                          { \"prim\": \"nat\", \"annots\": [ \"%total_stack\" ] } ] } ] } ] } ] },\n  { \"prim\": \"code\",\n    \"args\":\n      [ [ { \"prim\": \"LAMBDA\",\n            \"args\":\n              [ { \"prim\": \"pair\",\n                  \"args\":\n                    [ { \"prim\": \"pair\",\n                        \"args\": [ { \"prim\": \"nat\" }, { \"prim\": \"address\" } ] },\n                      { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"address\" }, { \"prim\": \"address\" } ] } ] },\n                { \"prim\": \"list\", \"args\": [ { \"prim\": \"operation\" } ] },\n                [ { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"CONTRACT\",\n                    \"args\":\n                      [ { \"prim\": \"list\",\n                          \"args\":\n                            [ { \"prim\": \"pair\",\n                                \"args\":\n                                  [ { \"prim\": \"address\",\n                                      \"annots\": [ \"%from_\" ] },\n                                    { \"prim\": \"list\",\n                                      \"args\":\n                                        [ { \"prim\": \"pair\",\n                                            \"args\":\n                                              [ { \"prim\": \"address\",\n                                                  \"annots\": [ \"%to_\" ] },\n                                                { \"prim\": \"pair\",\n                                                  \"args\":\n                                                    [ { \"prim\": \"nat\",\n                                                        \"annots\":\n                                                          [ \"%token_id\" ] },\n                                                      { \"prim\": \"nat\",\n                                                        \"annots\":\n                                                          [ \"%amount\" ] } ] } ] } ],\n                                      \"annots\": [ \"%txs\" ] } ] } ] } ],\n                    \"annots\": [ \"%transfer\" ] },\n                  { \"prim\": \"IF_NONE\",\n                    \"args\":\n                      [ [ { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"string\" },\n                                { \"string\": \"FA2_TOKEN_NOT_FOUND\" } ] },\n                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                  { \"prim\": \"PUSH\",\n                    \"args\": [ { \"prim\": \"mutez\" }, { \"int\": \"0\" } ] },\n                  { \"prim\": \"NIL\",\n                    \"args\":\n                      [ { \"prim\": \"pair\",\n                          \"args\":\n                            [ { \"prim\": \"address\" },\n                              { \"prim\": \"list\",\n                                \"args\":\n                                  [ { \"prim\": \"pair\",\n                                      \"args\":\n                                        [ { \"prim\": \"address\" },\n                                          { \"prim\": \"pair\",\n                                            \"args\":\n                                              [ { \"prim\": \"nat\" },\n                                                { \"prim\": \"nat\" } ] } ] } ] } ] } ] },\n                  { \"prim\": \"NIL\",\n                    \"args\":\n                      [ { \"prim\": \"pair\",\n                          \"args\":\n                            [ { \"prim\": \"address\" },\n                              { \"prim\": \"pair\",\n                                \"args\":\n                                  [ { \"prim\": \"nat\" }, { \"prim\": \"nat\" } ] } ] } ] },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"5\" } ] },\n                  { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"6\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                  { \"prim\": \"PUSH\",\n                    \"args\": [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                  { \"prim\": \"PAIR\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"6\" } ] },\n                  { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"7\" } ] },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                  { \"prim\": \"CONS\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"5\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" }, { \"prim\": \"PAIR\" },\n                  { \"prim\": \"CONS\" }, { \"prim\": \"TRANSFER_TOKENS\" },\n                  { \"prim\": \"CONS\" } ] ] },\n          { \"prim\": \"LAMBDA\",\n            \"args\":\n              [ { \"prim\": \"pair\",\n                  \"args\":\n                    [ { \"prim\": \"address\" },\n                      { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"pair\",\n                                    \"args\":\n                                      [ { \"prim\": \"big_map\",\n                                          \"args\":\n                                            [ { \"prim\": \"address\" },\n                                              { \"prim\": \"pair\",\n                                                \"args\":\n                                                  [ { \"prim\": \"pair\",\n                                                      \"args\":\n                                                        [ { \"prim\": \"nat\" },\n                                                          { \"prim\": \"nat\" } ] },\n                                                    { \"prim\": \"nat\" } ] } ] },\n                                        { \"prim\": \"address\" } ] },\n                                  { \"prim\": \"pair\",\n                                    \"args\":\n                                      [ { \"prim\": \"pair\",\n                                          \"args\":\n                                            [ { \"prim\": \"pair\",\n                                                \"args\":\n                                                  [ { \"prim\": \"nat\" },\n                                                    { \"prim\": \"nat\" } ] },\n                                              { \"prim\": \"nat\" } ] },\n                                        { \"prim\": \"timestamp\" } ] } ] },\n                            { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"pair\",\n                                    \"args\":\n                                      [ { \"prim\": \"nat\" },\n                                        { \"prim\": \"address\" } ] },\n                                  { \"prim\": \"pair\",\n                                    \"args\":\n                                      [ { \"prim\": \"address\" },\n                                        { \"prim\": \"nat\" } ] } ] } ] } ] },\n                { \"prim\": \"pair\",\n                  \"args\":\n                    [ { \"prim\": \"pair\",\n                        \"args\": [ { \"prim\": \"nat\" }, { \"prim\": \"nat\" } ] },\n                      { \"prim\": \"nat\" } ] },\n                [ { \"prim\": \"DUP\" }, { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"SWAP\" }, { \"prim\": \"CAR\" },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"SWAP\" },\n                  { \"prim\": \"GET\" },\n                  { \"prim\": \"IF_NONE\",\n                    \"args\":\n                      [ [ { \"prim\": \"PUSH\",\n                            \"args\": [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                          { \"prim\": \"PUSH\",\n                            \"args\": [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                          { \"prim\": \"PUSH\",\n                            \"args\": [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                          { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" } ], [] ] } ] ] },\n          { \"prim\": \"LAMBDA\",\n            \"args\":\n              [ { \"prim\": \"pair\",\n                  \"args\":\n                    [ { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"big_map\",\n                                    \"args\":\n                                      [ { \"prim\": \"address\" },\n                                        { \"prim\": \"pair\",\n                                          \"args\":\n                                            [ { \"prim\": \"pair\",\n                                                \"args\":\n                                                  [ { \"prim\": \"nat\" },\n                                                    { \"prim\": \"nat\" } ] },\n                                              { \"prim\": \"nat\" } ] } ] },\n                                  { \"prim\": \"address\" } ] },\n                            { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"pair\",\n                                    \"args\":\n                                      [ { \"prim\": \"pair\",\n                                          \"args\":\n                                            [ { \"prim\": \"nat\" },\n                                              { \"prim\": \"nat\" } ] },\n                                        { \"prim\": \"nat\" } ] },\n                                  { \"prim\": \"timestamp\" } ] } ] },\n                      { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"nat\" }, { \"prim\": \"address\" } ] },\n                            { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"address\" }, { \"prim\": \"nat\" } ] } ] } ] },\n                { \"prim\": \"pair\",\n                  \"args\":\n                    [ { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"big_map\",\n                                    \"args\":\n                                      [ { \"prim\": \"address\" },\n                                        { \"prim\": \"pair\",\n                                          \"args\":\n                                            [ { \"prim\": \"pair\",\n                                                \"args\":\n                                                  [ { \"prim\": \"nat\" },\n                                                    { \"prim\": \"nat\" } ] },\n                                              { \"prim\": \"nat\" } ] } ] },\n                                  { \"prim\": \"address\" } ] },\n                            { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"pair\",\n                                    \"args\":\n                                      [ { \"prim\": \"pair\",\n                                          \"args\":\n                                            [ { \"prim\": \"nat\" },\n                                              { \"prim\": \"nat\" } ] },\n                                        { \"prim\": \"nat\" } ] },\n                                  { \"prim\": \"timestamp\" } ] } ] },\n                      { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"nat\" }, { \"prim\": \"address\" } ] },\n                            { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"address\" }, { \"prim\": \"nat\" } ] } ] } ] },\n                [ { \"prim\": \"NOW\" }, { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"COMPARE\" }, { \"prim\": \"LT\" },\n                  { \"prim\": \"IF\",\n                    \"args\":\n                      [ [ { \"prim\": \"PUSH\",\n                            \"args\": [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                          { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                          { \"prim\": \"CDR\" }, { \"prim\": \"COMPARE\" },\n                          { \"prim\": \"GT\" },\n                          { \"prim\": \"IF\",\n                            \"args\":\n                              [ [ { \"prim\": \"DUP\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"NOW\" },\n                                  { \"prim\": \"SUB\" }, { \"prim\": \"ABS\" },\n                                  { \"prim\": \"MUL\" }, { \"prim\": \"EDIV\" },\n                                  { \"prim\": \"IF_NONE\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\": \"DIV by 0\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"ADD\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" } ], [] ] },\n                          { \"prim\": \"DUP\" }, { \"prim\": \"CDR\" },\n                          { \"prim\": \"NOW\" },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" } ], [] ] } ] ] },\n          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] }, { \"prim\": \"DUP\" },\n          { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" }, { \"prim\": \"CAR\" },\n          { \"prim\": \"IF_LEFT\",\n            \"args\":\n              [ [ { \"prim\": \"IF_LEFT\",\n                    \"args\":\n                      [ [ { \"prim\": \"IF_LEFT\",\n                            \"args\":\n                              [ [ { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DROP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DROP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DROP\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"COMPARE\" }, { \"prim\": \"NEQ\" },\n                                  { \"prim\": \"IF\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"DROP\" },\n                                          { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\": \"SF_DENIED\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ],\n                                        [ { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"PAIR\" },\n                                          { \"prim\": \"PAIR\" },\n                                          { \"prim\": \"PAIR\" } ] ] },\n                                  { \"prim\": \"NIL\",\n                                    \"args\": [ { \"prim\": \"operation\" } ] },\n                                  { \"prim\": \"PAIR\" } ],\n                                [ { \"prim\": \"DROP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"SUB\" },\n                                  { \"prim\": \"ABS\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"MUL\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"ADD\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"COMPARE\" }, { \"prim\": \"EQ\" },\n                                  { \"prim\": \"IF\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\":\n                                                    \"SF_NO_REWARDS_YET\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"6\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"7\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"SOME\" }, { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"UPDATE\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"SENDER\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"SELF\" }, { \"prim\": \"ADDRESS\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"nat\" },\n                                        { \"int\": \"1000\" } ] },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"MUL\" },\n                                  { \"prim\": \"EDIV\" },\n                                  { \"prim\": \"IF_NONE\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\": \"DIV by 0\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"ADD\" },\n                                  { \"prim\": \"NIL\",\n                                    \"args\":\n                                      [ { \"prim\": \"pair\",\n                                          \"args\":\n                                            [ { \"prim\": \"nat\" },\n                                              { \"prim\": \"pair\",\n                                                \"args\":\n                                                  [ { \"prim\": \"address\" },\n                                                    { \"prim\": \"nat\" } ] } ] } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"SELF\" },\n                                  { \"prim\": \"ADDRESS\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"CONS\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CONTRACT\",\n                                    \"args\":\n                                      [ { \"prim\": \"list\",\n                                          \"args\":\n                                            [ { \"prim\": \"pair\",\n                                                \"args\":\n                                                  [ { \"prim\": \"nat\",\n                                                      \"annots\":\n                                                        [ \"%token_id\" ] },\n                                                    { \"prim\": \"pair\",\n                                                      \"args\":\n                                                        [ { \"prim\": \"address\",\n                                                            \"annots\":\n                                                              [ \"%user\" ] },\n                                                          { \"prim\": \"nat\",\n                                                            \"annots\":\n                                                              [ \"%amount\" ] } ] } ] } ] } ],\n                                    \"annots\": [ \"%mint\" ] },\n                                  { \"prim\": \"IF_NONE\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\":\n                                                    \"FA2_TOKEN_NOT_FOUND\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"mutez\" }, { \"int\": \"0\" } ] },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"TRANSFER_TOKENS\" },\n                                  { \"prim\": \"CONS\" }, { \"prim\": \"PAIR\" } ] ] } ],\n                        [ { \"prim\": \"IF_LEFT\",\n                            \"args\":\n                              [ [ { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"SUB\" },\n                                  { \"prim\": \"ABS\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"MUL\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"ADD\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"ADD\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"6\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"SOME\" },\n                                  { \"prim\": \"SENDER\" }, { \"prim\": \"UPDATE\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"ADD\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"SELF\" }, { \"prim\": \"ADDRESS\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"PAIR\" } ],\n                                [ { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"SUB\" },\n                                  { \"prim\": \"ABS\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"MUL\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"ADD\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"COMPARE\" }, { \"prim\": \"EQ\" },\n                                  { \"prim\": \"IF\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"DUP\" },\n                                          { \"prim\": \"CDR\" } ],\n                                        [ { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"3\" } ] } ] ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"COMPARE\" }, { \"prim\": \"GT\" },\n                                  { \"prim\": \"IF\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"PUSH\",\n                                            \"args\":\n                                              [ { \"prim\": \"string\" },\n                                                { \"string\":\n                                                    \"SF_INSUFFICIENT_BALANCE\" } ] },\n                                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"SUB\" },\n                                  { \"prim\": \"ABS\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CDR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"5\" } ] },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"CAR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"4\" } ] },\n                                  { \"prim\": \"SOME\" }, { \"prim\": \"SENDER\" },\n                                  { \"prim\": \"UPDATE\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"SUB\" },\n                                  { \"prim\": \"ABS\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                                  { \"prim\": \"DUG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"SWAP\" },\n                                  { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DUP\" }, { \"prim\": \"CDR\" },\n                                  { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" },\n                                  { \"prim\": \"SENDER\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"SELF\" }, { \"prim\": \"ADDRESS\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" },\n                                  { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"2\" } ] },\n                                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" },\n                                  { \"prim\": \"PAIR\" } ] ] } ] ] } ],\n                [ { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"DROP\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"DROP\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"DROP\" }, { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"SENDER\" }, { \"prim\": \"COMPARE\" },\n                  { \"prim\": \"NEQ\" },\n                  { \"prim\": \"IF\",\n                    \"args\":\n                      [ [ { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"string\" },\n                                { \"string\": \"SF_DENIED\" } ] },\n                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CDR\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"3\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"PAIR\" },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                  { \"prim\": \"PAIR\" },\n                  { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n                  { \"prim\": \"PAIR\" } ] ] } ] ] } ]",
  "source": "//////////////////////////////\n// single token farm bucket\n//\n// Requres to have minter permission on reward_token\n//////////////////////////////\n\ntype farm_config is record [\n  reward_amount_per_sec: nat;  // reward amount in utokens per second\n  mint_rate_permil: nat;       // permill of acc reward to mint\n  mint_min_amount: nat;        // static minimum mint amount per second\n]\n\ntype farmer_account is record [\n  stake_amount: nat;\n  reward_amount: nat;\n  last_reward_per_stake: nat;\n]\n\ntype storage is record [\n  admin: address;\n  token: address;                             // this bucket token to stake\n  reward_token: address;                      // token for rewards\n  config: farm_config;                        // rates configuration \n  accounts: big_map(address, farmer_account); // accounts invested\n  total_stack: nat;\n  reward_per_stake: nat;                      // current reward per staked utoken\n  last_update_time: timestamp;\n]\n\n#include \"../../partial/FA2Api.ligo\"\n\nfunction get_farmer(const acc: address; const s: storage) : farmer_account is \n    case s.accounts[acc] of\n    | Some(a) -> a\n    | None -> record[\n        stake_amount = 0n;\n        reward_amount = 0n;\n        last_reward_per_stake = 0n;\n    ]\n    end\n\nfunction calc_reward_rate(const s: storage): storage is \n  block {\n    if s.last_update_time < Tezos.now then block {\n      if s.total_stack > 0n then block {\n        s.reward_per_stake := s.reward_per_stake + abs(Tezos.now - s.last_update_time) * s.config.reward_amount_per_sec / s.total_stack;\n      }\n      else\n        skip;\n\n      s.last_update_time := Tezos.now;\n    }\n    else\n      skip;\n  } with(s)\n\nfunction mint(const reward_amount: nat; const s: storage): operation is \n  block {\n    var mint_amount := (s.config.mint_rate_permil * reward_amount) / 1000n + s.config.mint_min_amount;\n    \n  } with(call_mint_op(s.reward_token, list[record[token_id = 0n; user = Tezos.self_address; amount = mint_amount]]))\n\nfunction stake(const token_amount: nat; var s: storage): list(operation) * storage is \n  block {\n    s := calc_reward_rate(s);\n    var acc := get_farmer(Tezos.sender, s);\n    var reward_increase := (acc.stake_amount * abs(s.reward_per_stake - acc.last_reward_per_stake));\n    acc.reward_amount := acc.reward_amount + reward_increase;\n    acc.stake_amount := acc.stake_amount + token_amount;\n    acc.last_reward_per_stake := s.reward_per_stake;\n    \n    s.accounts[Tezos.sender] := acc;\n    s.total_stack := s.total_stack + token_amount;\n\n    var ops := call_transfer_op(record [token = s.token; from_addr = Tezos.sender; to_addr = Tezos.self_address; amount = token_amount]);\n  } with(ops, s)\n\nfunction unstake(const token_amount: nat; var s: storage): list(operation) * storage is \n  block {\n    s := calc_reward_rate(s);\n    var acc := get_farmer(Tezos.sender, s);\n    var reward_increase := (acc.stake_amount * abs(s.reward_per_stake - acc.last_reward_per_stake));\n    acc.reward_amount := acc.reward_amount + reward_increase;\n\n    var eff_token_amount : nat := 0n;\n    if token_amount = 0n then\n      eff_token_amount := acc.stake_amount;\n    else\n      eff_token_amount := token_amount;\n    \n    if token_amount > acc.stake_amount then\n      failwith(\"SF_INSUFFICIENT_BALANCE\");\n    else\n      skip;\n      \n    acc.stake_amount := abs(acc.stake_amount - eff_token_amount);\n    s.accounts[Tezos.sender] := acc;\n    s.total_stack := abs(s.total_stack - eff_token_amount);\n\n    var ops := call_transfer_op(record [token = s.token; from_addr = Tezos.self_address; to_addr = Tezos.sender; amount = eff_token_amount]);\n  } with(ops, s)\n\n// transfer whole account reward amount\nfunction claim(var s: storage): list(operation) * storage is \n  block {\n    s := calc_reward_rate(s);\n    var acc := get_farmer(Tezos.sender, s);\n    var reward_increase := (acc.stake_amount * abs(s.reward_per_stake - acc.last_reward_per_stake));\n    acc.reward_amount := acc.reward_amount + reward_increase;\n    acc.last_reward_per_stake := s.reward_per_stake;\n\n    var reward_to_pay := acc.reward_amount;\n\n    if reward_to_pay = 0n then\n      failwith(\"SF_NO_REWARDS_YET\");\n    else\n      skip;\n    acc.reward_amount := 0n;\n    s.accounts[Tezos.sender] := acc;\n    var ops := call_transfer_op(record [token = s.reward_token; from_addr = Tezos.self_address; to_addr = Tezos.sender; amount = reward_to_pay]);\n    ops := mint(reward_to_pay, s) # ops;\n  } with(ops, s)\n\nfunction change_admin(const acc: address; var s: storage): storage is \n  block {\n      if Tezos.sender =/= s.admin then\n        failwith(\"SF_DENIED\")\n      else\n        s.admin := acc;\n  } with (s)\n\nfunction update_config(const config : farm_config; var s: storage) : storage is\n  block {\n    if Tezos.sender =/= s.admin then\n      failwith(\"SF_DENIED\");\n    else\n      skip;\n    s.config := config;\n  } with(s)\n\n\ntype action is \n  | Stake of nat\n  | Unstake of nat\n  | Claim of unit\n  | ChangeAdmin of address\n  | UpdateConfig of farm_config\n\nfunction main(const action : action; const s : storage) : list(operation) * storage  is\n  case action of\n  | Stake(args)        -> stake(args, s)\n  | Unstake(args)      -> unstake(args, s)\n  | Claim          -> claim(s)\n  | ChangeAdmin(args)  -> ((nil : list(operation)), change_admin(args, s))\n  | UpdateConfig(args) -> ((nil : list(operation)), update_config(args, s))\n  end;\n",
  "sourcePath": "/home/helder/Documents/GitHub/comparatif_projet_defi/SpaceFarm/contracts/main/farm/FarmBucket.ligo",
  "compiler": {
    "name": "ligo",
    "version": "next"
  },
  "networks": {},
  "schemaVersion": "3.2.0-tezos.1",
  "updatedAt": "2021-10-07T08:09:47.290Z"
}